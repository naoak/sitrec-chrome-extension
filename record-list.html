<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/core-ajax/core-ajax.html">
<link rel="import" href="bower_components/paper-shadow/paper-shadow.html">
<link rel="import" href="record-item.html">

<polymer-element name="record-list">
  <template>
    <style>
    :host {
      display: block;
      padding: 25px;
      box-sizing: border-box;
    }
    </style>
    <chrome-storage name="server" value="{{server}}" on-chrome-storage-load="{{loadDetailList}}"></chrome-storage>
    <core-ajax id="ajax" url="{{server}}/api/record/detailList" handleAs="json"></core-ajax>
    <div horizontal layout wrap>
    <template repeat='{{records}}'>
      <record-item name="{{name}}" url="{{url}}" throttle="{{throttle}}" timing="{{timing}}" date="{{date}}"></record-item>
    </template>
    </div>
  </template>
  <script>
  Polymer({
    created: function() {
      this.records = [];
    },
    ready: function() {
      var self = this;
      this.$.ajax.addEventListener('core-response', function(e) {
        var records = this.response.items;
        self.records = records.map(function(r) {
          var i = r.url.indexOf('://');
          if (i >= 0) {
            r.url = r.url.slice(i + 3);
          }
          return r;
        });
      });
    },
    loadDetailList: function() {
      this.$.ajax.go();
    }
  });
  </script>
</polymer-element>
