<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/core-ajax/core-ajax.html">
<link rel="import" href="bower_components/paper-shadow/paper-shadow.html">
<link rel="import" href="record-item.html">

<polymer-element name="record-list" attributes="server">
  <template>
    <style>
    :host {
      display: block;
    }
    :host ul {
      margin: 0;
      padding: 25px;
      list-style-type: none;
      box-sizing: border-box;
    }
    :host li {
      margin: 0;
      padding: 0;
    }
    </style>
    <core-ajax id="ajax" url="{{server}}/api/record/detailList" handleAs="json"></core-ajax>
    <core-toolbar>
      <core-icon-button icon="file-download"></core-icon-button>
      <core-icon-button icon="delete" on-tap="{{menuAction}}"></core-icon-button>
    </core-toolbar>
    <ul horizontal layout wrap>
    <template repeat='{{records}}'>
      <li>
        <record-item name="{{name}}" url="{{url}}" throttle="{{throttle}}" timing="{{timing}}" date="{{date}}" fullName="{{fullName}}"></record-item>
      </li>
    </template>
    </ul>
  </template>
  <script>
  Polymer({
    created: function() {
      this.records = [];
    },
    ready: function() {
      var self = this;
      this.$.ajax.addEventListener('core-response', function(e) {
        var records = this.response.items;
        self.records = records.map(function(r) {
          function trimProtocol(url) {
            var i = url.indexOf('://');
            if (i >= 0) {
              url = url.slice(i + 3);
            }
            return url;
          }
          r.url = trimProtocol(r.url);
          return r;
        });
      });
    },
    serverChanged: function() {
      this.loadDetailList();
    },
    loadDetailList: function() {
      this.$.ajax.go();
    }
  });
  </script>
</polymer-element>
