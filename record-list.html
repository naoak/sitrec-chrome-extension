<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/core-ajax/core-ajax.html">
<link rel="import" href="bower_components/paper-shadow/paper-shadow.html">
<link rel="import" href="record-item.html">

<polymer-element name="record-list">
  <template>
    <style>
    :host {
      display: block;
      padding: 25px;
      box-sizing: border-box;
    }
    :host ul {
      margin: 0;
      padding: 0;
      list-style-type: none;
    }
    :host li {
      margin: 0;
      padding: 0;
    }
    </style>
    <chrome-storage name="server" value="{{server}}" on-chrome-storage-load="{{loadDetailList}}"></chrome-storage>
    <core-ajax id="ajax" url="{{server}}/api/record/detailList" handleAs="json"></core-ajax>
    <ul horizontal layout wrap>
    <template repeat='{{records}}'>
      <li>
        <record-item name="{{name}}" url="{{url}}" throttle="{{throttle}}" timing="{{timing}}" date="{{date}}"></record-item>
      </li>
    </template>
    </ul>
  </template>
  <script>
  Polymer({
    created: function() {
      this.records = [];
    },
    ready: function() {
      var self = this;
      this.$.ajax.addEventListener('core-response', function(e) {
        var records = this.response.items;
        self.records = records.map(function(r) {
          function trimProtocol(url) {
            var i = url.indexOf('://');
            if (i >= 0) {
              url = url.slice(i + 3);
            }
            return url;
          }
          r.url = trimProtocol(r.url);
          return r;
        });
      });
    },
    loadDetailList: function() {
      this.$.ajax.go();
    }
  });
  </script>
</polymer-element>
